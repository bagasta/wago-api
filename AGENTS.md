# Repository Guidelines

## Project Structure & Module Organization
- `cmd/api/main.go` is the entrypoint; it wires config, database connections, repositories, use cases, and HTTP handlers.
- `internal/delivery/http` holds Fiber routing, middleware, and handlers; `internal/usecase` contains business logic; `internal/domain` defines entities and repository interfaces; `internal/infrastructure` provides database, WhatsApp client, and Langchain integrations.
- `pkg/config` loads configuration from `config/config.yaml` and environment variables (`.env`).
- `migrations/*.sql` define the schema; run them against the PostgreSQL database named `whatsapp_api`.
- API docs live in `docs/` (generated by swag) and surface at `/swagger/index.html`. Refer to `RUNNING.md` for step-by-step setup.

## Build, Test, and Development Commands
- Start in dev: `go run cmd/api/main.go` (reads `.env` and `config/config.yaml`).
- Build binary: `go build -o whatsapp-api cmd/api/main.go` then run `./whatsapp-api`.
- Format and vet: `go fmt ./...` then `go vet ./...` before committing.
- Tests: `go test ./...` (add new `_test.go` files alongside packages; currently minimal coverage).
- Migrations (manual): `psql -U postgres -d whatsapp_api -f migrations/00X_*.up.sql` in order. Confirm credentials in `.env`.
- Regenerate Swagger after handler or route changes: `swag init -g cmd/api/main.go -o docs`.

## Coding Style & Naming Conventions
- Use `gofmt` defaults (tabs, standard import grouping); keep functions small and context-aware (`ctx context.Context` as first param).
- Exported types and interfaces use PascalCase; unexported helpers use lowerCamelCase. Repository interfaces sit in `internal/domain/repository` and concrete adapters in `internal/infrastructure`.
- HTTP handlers should return `error` for Fiber to handle; prefer structured logging and explicit errors over `panic`.

## Testing Guidelines
- Add table-driven unit tests per package (`*_test.go` beside sources); prefer mocks/stubs for database and external clients.
- For integration tests, point to a disposable PostgreSQL database; avoid relying on production data.
- Aim to cover new branches (success/error paths) and auth checks; ensure `go test ./...` passes locally before opening a PR.

## Commit & Pull Request Guidelines
- Use concise Conventional Commit messages (`feat:`, `fix:`, `chore:`, `docs:`, `refactor:`). Mention migrations or config changes explicitly.
- PRs should include: summary of behavior change, linked issue/ID if available, notes on config/migration impacts, and testing performed (`go test ./...`, manual curl/Swagger checks). Add screenshots of Swagger changes when UI output matters (QR flow, etc.).

## Security & Configuration Tips
- Do not commit real secrets; keep `.env` local and provide sanitized samples when needed. Rotate the default API key (`secret`) outside dev.
- Keep database credentials in env vars; ensure `config/config.yaml` mirrors non-secret defaults only. Restrict QR and API responses to expected clients via middleware and rate limits in `config/security`.
